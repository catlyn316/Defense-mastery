-- åŸºæœ¬æœå‹™èˆ‡ç©å®¶
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer
local TweenService = game:GetService("TweenService")

-- å„²å­˜è‡ªå®šç¾©åç¨±
local savedName = "catlyn"

-- å…¨åŸŸè®Šæ•¸
local isAutoAbilityEnabled = false
local autoAbilityLoop = nil
local isAutoAttackEnabled = false
local autoAttackLoop = nil
local isHelpModeEnabled = false
local helpModeLoop = nil
local currentAbilityMode = "æ™®é€š"

-- è‡ªè¨‚ä½ç½®è®Šæ•¸
local customStartPosition = nil
local customStartCFrame = nil
local customEndPosition = nil
local customEndCFrame = nil

-- å°‹æ‰¾25å–®ä½å…§çš„ç©å®¶
local function findPlayerWithin25Units()
    local localCharacter = LocalPlayer.Character
    
    if not localCharacter or not localCharacter:FindFirstChild("HumanoidRootPart") then
        return nil
    end
    
    local localPosition = localCharacter.HumanoidRootPart.Position
    
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local distance = (player.Character.HumanoidRootPart.Position - localPosition).Magnitude
            if distance <= 25 then
                return player
            end
        end
    end
    
    return nil
end

-- å°‹æ‰¾10å–®ä½å…§çš„ç©å®¶
local function findPlayerWithin10Units()
    local localCharacter = LocalPlayer.Character
    
    if not localCharacter or not localCharacter:FindFirstChild("HumanoidRootPart") then
        return nil
    end
    
    local localPosition = localCharacter.HumanoidRootPart.Position
    
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local distance = (player.Character.HumanoidRootPart.Position - localPosition).Magnitude
            if distance <= 10 then
                return player
            end
        end
    end
    
    return nil
end

-- æª¢æŸ¥ç©å®¶æ˜¯å¦è™•æ–¼ragdollç‹€æ…‹
local function isPlayerRagdolled(player)
    if not player.Character then return false end
    
    local humanoid = player.Character:FindFirstChild("Humanoid")
    if not humanoid then return false end
    
    -- æª¢æŸ¥PlatformStandç‹€æ…‹ï¼ˆé€šå¸¸ç”¨æ–¼ragdollï¼‰
    return humanoid.PlatformStand == true
end

-- ä¿®æ”¹åç¨±æ¨™ç±¤çš„å‡½æ•¸
local function changeNametag()
    local playerName = LocalPlayer.Name
    local character = workspace:FindFirstChild(playerName)
    if character then
        local head = character:FindFirstChild("Head")
        if head then
            local nametagFolder = head:FindFirstChild("Nametag")
            if nametagFolder then
                local labels = nametagFolder:FindFirstChild("Labels")
                if labels then
                    local topLabel = labels:FindFirstChild("TopLabel")
                    if topLabel then
                        topLabel.Text = savedName
                    end
                end
            end
        end
    end
end

-- åˆæ¬¡åŸ·è¡Œä¿®æ”¹åç¨±
changeNametag()

-- ç›£è½è§’è‰²é‡ç”Ÿäº‹ä»¶ï¼Œé‡ç”Ÿå¾Œé‡æ–°æ‡‰ç”¨åç¨±
LocalPlayer.CharacterAdded:Connect(function(character)
    character:WaitForChild("Head", 10)
    wait(0.5)
    changeNametag()
end)

-- GUI ä¸»é«”
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
ScreenGui.Name = "BarrierHub"

-- ä¸»æ¡†æ¶æ¨£å¼
local Frame = Instance.new("Frame", ScreenGui)
Frame.Size = UDim2.new(0, 450, 0, 350)
Frame.Position = UDim2.new(0.5, -225, 0.5, -175)
Frame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
Frame.BorderSizePixel = 0
Frame.Active = true
Frame.Draggable = true

-- æ·»åŠ æ¼¸å±¤æ•ˆæœ
local gradient = Instance.new("UIGradient", Frame)
gradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(25, 25, 35)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(35, 35, 50))
}
gradient.Rotation = 45

-- æ·»åŠ å¤–ç™¼å…‰æ•ˆæœ
local stroke = Instance.new("UIStroke", Frame)
stroke.Color = Color3.fromRGB(100, 150, 255)
stroke.Thickness = 2
stroke.Transparency = 0.5

Instance.new("UICorner", Frame).CornerRadius = UDim.new(0, 15)

-- æ¨™é¡Œæ¨£å¼
local Title = Instance.new("TextLabel", Frame)
Title.Size = UDim2.new(1, -80, 0, 50)
Title.Position = UDim2.new(0, 15, 0, 0)
Title.BackgroundTransparency = 1
Title.Text = "ğŸ”° å±éšœ ğŸ”°"
Title.Font = Enum.Font.GothamBold
Title.TextSize = 22
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextXAlignment = Enum.TextXAlignment.Left

-- æ·»åŠ æ¨™é¡Œç™¼å…‰æ•ˆæœ
local titleStroke = Instance.new("UIStroke", Title)
titleStroke.Color = Color3.fromRGB(100, 150, 255)
titleStroke.Thickness = 1
titleStroke.Transparency = 0.3

-- é—œé–‰æŒ‰éˆ•æ¨£å¼å’ŒåŠŸèƒ½
local Close = Instance.new("TextButton", Frame)
Close.Size = UDim2.new(0, 35, 0, 35)
Close.Position = UDim2.new(1, -40, 0, 8)
Close.Text = "x"
Close.BackgroundColor3 = Color3.fromRGB(220, 60, 60)
Close.TextColor3 = Color3.fromRGB(255, 255, 255)
Close.Font = Enum.Font.GothamBold
Close.TextSize = 18
Close.BorderSizePixel = 0

-- æ·»åŠ é—œé–‰æŒ‰éˆ•æ•ˆæœ
local closeGradient = Instance.new("UIGradient", Close)
closeGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(220, 60, 60)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(180, 40, 40))
}

Instance.new("UICorner", Close).CornerRadius = UDim.new(0, 8)

-- é—œé–‰æŒ‰éˆ•åŠŸèƒ½
Close.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
    _G.barrierHubLoaded = false
end)

-- æœ€å°åŒ–æŒ‰éˆ•æ¨£å¼
local Minimize = Instance.new("TextButton", Frame)
Minimize.Size = UDim2.new(0, 35, 0, 35)
Minimize.Position = UDim2.new(1, -80, 0, 8)
Minimize.Text = "â”€"
Minimize.BackgroundColor3 = Color3.fromRGB(100, 100, 120)
Minimize.TextColor3 = Color3.fromRGB(255, 255, 255)
Minimize.Font = Enum.Font.GothamBold
Minimize.TextSize = 16
Minimize.BorderSizePixel = 0

local minimizeGradient = Instance.new("UIGradient", Minimize)
minimizeGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(100, 100, 120)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(80, 80, 100))
}

Instance.new("UICorner", Minimize).CornerRadius = UDim.new(0, 8)

-- å´é‚Šæ¬„ç‚ºå¯æ»¾å‹•
local SideBar = Instance.new("ScrollingFrame", Frame)
SideBar.Size = UDim2.new(0, 130, 1, -55)
SideBar.Position = UDim2.new(0, 5, 0, 50)
SideBar.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
SideBar.BorderSizePixel = 0
SideBar.ScrollBarThickness = 6
SideBar.CanvasSize = UDim2.new(0, 0, 0, 200)
SideBar.AutomaticCanvasSize = Enum.AutomaticSize.Y
SideBar.ScrollingDirection = Enum.ScrollingDirection.Y

-- æ·»åŠ å´é‚Šæ¬„æ¨£å¼
local sidebarGradient = Instance.new("UIGradient", SideBar)
sidebarGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(35, 35, 50)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(45, 45, 65))
}

Instance.new("UICorner", SideBar).CornerRadius = UDim.new(0, 10)

-- æ·»åŠ UIListLayoutåˆ°å´é‚Šæ¬„
local sidebarLayout = Instance.new("UIListLayout", SideBar)
sidebarLayout.Padding = UDim.new(0, 8)
sidebarLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center

-- å…§å®¹å€åŸŸ
local Content = Instance.new("Frame", Frame)
Content.Size = UDim2.new(1, -145, 1, -55)
Content.Position = UDim2.new(0, 140, 0, 50)
Content.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
Content.BorderSizePixel = 0

local contentGradient = Instance.new("UIGradient", Content)
contentGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(40, 40, 60)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(50, 50, 75))
}

Instance.new("UICorner", Content).CornerRadius = UDim.new(0, 10)

-- ç¸®å°åŠŸèƒ½
local isMinimized = false
local fullSize = UDim2.new(0, 450, 0, 350)
local miniSize = UDim2.new(0, 450, 0, 50)

Minimize.MouseButton1Click:Connect(function()
    isMinimized = not isMinimized
    SideBar.Visible = not isMinimized
    Content.Visible = not isMinimized
    Frame.Size = isMinimized and miniSize or fullSize
end)

-- å‰µå»ºåˆ†å€æŒ‰éˆ•çš„å‡½æ•¸
local function createSectionButton(text, order, parent)
    local btn = Instance.new("TextButton", parent)
    btn.Size = UDim2.new(0, 120, 0, 45)
    btn.Text = text
    btn.BackgroundColor3 = Color3.fromRGB(85, 85, 105)
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.TextTransparency = 0
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 16
    btn.BorderSizePixel = 0
    
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 10)
    
    local btnStroke = Instance.new("UIStroke", btn)
    btnStroke.Color = Color3.fromRGB(150, 180, 255)
    btnStroke.Thickness = 1
    btnStroke.Transparency = 0.6
    
    btn.MouseEnter:Connect(function()
        btn.BackgroundColor3 = Color3.fromRGB(105, 105, 125)
        btnStroke.Transparency = 0.3
    end)
    
    btn.MouseLeave:Connect(function()
        btn.BackgroundColor3 = Color3.fromRGB(85, 85, 105)
        btnStroke.Transparency = 0.6
    end)
    
    return btn
end

-- å‰µå»ºå”¯ä¸€åˆ†å€æŒ‰éˆ•
local Section1 = createSectionButton("ğŸ”°", 1, SideBar)

-- ä¸»è¦å…§å®¹å€åŸŸ
local MainScroll = Instance.new("ScrollingFrame", Content)
MainScroll.Size = UDim2.new(1, 0, 1, 0)
MainScroll.CanvasSize = UDim2.new(0, 0, 0, 300)
MainScroll.ScrollBarThickness = 6
MainScroll.BackgroundTransparency = 1
MainScroll.Visible = true
MainScroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
MainScroll.VerticalScrollBarInset = Enum.ScrollBarInset.ScrollBar
MainScroll.ScrollingDirection = Enum.ScrollingDirection.Y

-- è‡ªå‹•ä½¿ç”¨èƒ½åŠ›ä¸‹æ‹‰é¸å–®æŒ‰éˆ•
local autoAbilityDropdownBtn = Instance.new("TextButton", MainScroll)
autoAbilityDropdownBtn.Size = UDim2.new(0, 180, 0, 35)
autoAbilityDropdownBtn.Position = UDim2.new(0.5, -90, 0, 10)
autoAbilityDropdownBtn.Text = "æ™®é€š â–¼"
autoAbilityDropdownBtn.BackgroundColor3 = Color3.fromRGB(80, 140, 220)
autoAbilityDropdownBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
autoAbilityDropdownBtn.TextSize = 16
autoAbilityDropdownBtn.Font = Enum.Font.GothamBold
autoAbilityDropdownBtn.BorderSizePixel = 0

Instance.new("UICorner", autoAbilityDropdownBtn).CornerRadius = UDim.new(0, 8)

local autoAbilityDropdownStroke = Instance.new("UIStroke", autoAbilityDropdownBtn)
autoAbilityDropdownStroke.Color = Color3.fromRGB(120, 170, 255)
autoAbilityDropdownStroke.Thickness = 1
autoAbilityDropdownStroke.Transparency = 0.6

-- è‡ªå‹•ä½¿ç”¨èƒ½åŠ›ä¸‹æ‹‰èœå–®
local autoAbilityDropdownMenu = Instance.new("Frame", MainScroll)
autoAbilityDropdownMenu.Size = UDim2.new(0, 180, 0, 70)
autoAbilityDropdownMenu.Position = UDim2.new(0.5, -90, 0, 45)
autoAbilityDropdownMenu.BackgroundColor3 = Color3.fromRGB(45, 45, 65)
autoAbilityDropdownMenu.BorderSizePixel = 0
autoAbilityDropdownMenu.Visible = false

Instance.new("UICorner", autoAbilityDropdownMenu).CornerRadius = UDim.new(0, 8)

local autoAbilityMenuStroke = Instance.new("UIStroke", autoAbilityDropdownMenu)
autoAbilityMenuStroke.Color = Color3.fromRGB(120, 170, 255)
autoAbilityMenuStroke.Thickness = 1
autoAbilityMenuStroke.Transparency = 0.6

-- è‡ªå‹•ä½¿ç”¨èƒ½åŠ›ä¸‹æ‹‰é¸é …1
local autoAbilityOption1 = Instance.new("TextButton", autoAbilityDropdownMenu)
autoAbilityOption1.Size = UDim2.new(1, 0, 0, 35)
autoAbilityOption1.Position = UDim2.new(0, 0, 0, 0)
autoAbilityOption1.Text = "æ™®é€š"
autoAbilityOption1.BackgroundColor3 = Color3.fromRGB(60, 60, 85)
autoAbilityOption1.TextColor3 = Color3.fromRGB(255, 255, 255)
autoAbilityOption1.TextSize = 14
autoAbilityOption1.Font = Enum.Font.Gotham
autoAbilityOption1.BorderSizePixel = 0

-- è‡ªå‹•ä½¿ç”¨èƒ½åŠ›ä¸‹æ‹‰é¸é …2
local autoAbilityOption2 = Instance.new("TextButton", autoAbilityDropdownMenu)
autoAbilityOption2.Size = UDim2.new(1, 0, 0, 35)
autoAbilityOption2.Position = UDim2.new(0, 0, 0, 35)
autoAbilityOption2.Text = "è‡ªè¨‚ä½ç½®"
autoAbilityOption2.BackgroundColor3 = Color3.fromRGB(60, 60, 85)
autoAbilityOption2.TextColor3 = Color3.fromRGB(255, 255, 255)
autoAbilityOption2.TextSize = 14
autoAbilityOption2.Font = Enum.Font.Gotham
autoAbilityOption2.BorderSizePixel = 0

-- è‡ªå‹•ä½¿ç”¨èƒ½åŠ›é–‹é—œæŒ‰éˆ•
local autoAbilityBtn = Instance.new("TextButton", MainScroll)
autoAbilityBtn.Size = UDim2.new(0, 180, 0, 35)
autoAbilityBtn.Position = UDim2.new(0.5, -90, 0, 55)
autoAbilityBtn.Text = "è‡ªå‹•ä½¿ç”¨èƒ½åŠ›: é—œ"
autoAbilityBtn.BackgroundColor3 = Color3.fromRGB(80, 140, 220)
autoAbilityBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
autoAbilityBtn.TextSize = 16
autoAbilityBtn.Font = Enum.Font.GothamBold
autoAbilityBtn.BorderSizePixel = 0

Instance.new("UICorner", autoAbilityBtn).CornerRadius = UDim.new(0, 8)

local abilityBtnStroke = Instance.new("UIStroke", autoAbilityBtn)
abilityBtnStroke.Color = Color3.fromRGB(120, 170, 255)
abilityBtnStroke.Thickness = 1
abilityBtnStroke.Transparency = 0.6

-- è‡ªå‹•æ”»æ“ŠæŒ‰éˆ•
local autoAttackBtn = Instance.new("TextButton", MainScroll)
autoAttackBtn.Size = UDim2.new(0, 180, 0, 35)
autoAttackBtn.Position = UDim2.new(0.5, -90, 0, 100)
autoAttackBtn.Text = "è‡ªå‹•æ”»æ“Š: é—œ"
autoAttackBtn.BackgroundColor3 = Color3.fromRGB(80, 140, 220)
autoAttackBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
autoAttackBtn.TextSize = 16
autoAttackBtn.Font = Enum.Font.GothamBold
autoAttackBtn.BorderSizePixel = 0

Instance.new("UICorner", autoAttackBtn).CornerRadius = UDim.new(0, 8)

local attackBtnStroke = Instance.new("UIStroke", autoAttackBtn)
attackBtnStroke.Color = Color3.fromRGB(120, 170, 255)
attackBtnStroke.Thickness = 1
attackBtnStroke.Transparency = 0.6

-- è¼¸å…¥æ¡†
local playerInput = Instance.new("TextBox", MainScroll)
playerInput.Size = UDim2.new(0, 180, 0, 35)
playerInput.Position = UDim2.new(0.5, -90, 0, 145)
playerInput.PlaceholderText = "è¼¸å…¥ç©å®¶åç¨±"
playerInput.Text = ""
playerInput.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
playerInput.TextColor3 = Color3.fromRGB(255, 255, 255)
playerInput.PlaceholderColor3 = Color3.fromRGB(180, 180, 180)
playerInput.TextSize = 14
playerInput.Font = Enum.Font.Gotham
playerInput.BorderSizePixel = 0

Instance.new("UICorner", playerInput).CornerRadius = UDim.new(0, 8)

local inputStroke = Instance.new("UIStroke", playerInput)
inputStroke.Color = Color3.fromRGB(120, 170, 255)
inputStroke.Thickness = 1
inputStroke.Transparency = 0.6

-- å¹«åŠ©æ¨¡å¼æŒ‰éˆ•
local helpModeBtn = Instance.new("TextButton", MainScroll)
helpModeBtn.Size = UDim2.new(0, 180, 0, 35)
helpModeBtn.Position = UDim2.new(0.5, -90, 0, 190)
helpModeBtn.Text = "å¹«åŠ©æ¨¡å¼: é—œ"
helpModeBtn.BackgroundColor3 = Color3.fromRGB(80, 140, 220)
helpModeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
helpModeBtn.TextSize = 16
helpModeBtn.Font = Enum.Font.GothamBold
helpModeBtn.BorderSizePixel = 0

Instance.new("UICorner", helpModeBtn).CornerRadius = UDim.new(0, 8)

local helpBtnStroke = Instance.new("UIStroke", helpModeBtn)
helpBtnStroke.Color = Color3.fromRGB(120, 170, 255)
helpBtnStroke.Thickness = 1
helpBtnStroke.Transparency = 0.6

-- å‰µå»ºè£œé–“å‹•ç•«å‡½æ•¸
local function animateButtonPosition(button, targetPosition, duration)
    local tweenInfo = TweenInfo.new(
        duration or 0.3,
        Enum.EasingStyle.Quart,
        Enum.EasingDirection.Out
    )
    local tween = TweenService:Create(button, tweenInfo, {Position = targetPosition})
    tween:Play()
    return tween
end

-- è‡ªå‹•ä½¿ç”¨èƒ½åŠ›ä¸‹æ‹‰é¸å–®åŠŸèƒ½
autoAbilityDropdownBtn.MouseButton1Click:Connect(function()
    -- å…³é—­å¸®åŠ©æ¨¡å¼ä¸‹æ‹‰é€‰å•
    if helpModeDropdownMenu.Visible then
        helpModeDropdownMenu.Visible = false
        animateButtonPosition(helpModeBtn, UDim2.new(0.5, -90, 0, 280))
    end
    
    autoAbilityDropdownMenu.Visible = not autoAbilityDropdownMenu.Visible
    
    if autoAbilityDropdownMenu.Visible then
        -- é¸å–®å±•é–‹æ™‚ï¼Œå°‡å…¶ä»–æŒ‰éˆ•å‘ä¸‹ç§»å‹•
        animateButtonPosition(autoAbilityBtn, UDim2.new(0.5, -90, 0, 125))
        animateButtonPosition(autoAttackBtn, UDim2.new(0.5, -90, 0, 170))
        animateButtonPosition(playerInput, UDim2.new(0.5, -90, 0, 215))
        animateButtonPosition(helpModeBtn, UDim2.new(0.5, -90, 0, 260))
    else
        -- é¸å–®é—œé–‰æ™‚ï¼Œå°‡å…¶ä»–æŒ‰éˆ•ç§»å›åŸä½
        animateButtonPosition(autoAbilityBtn, UDim2.new(0.5, -90, 0, 55))
        animateButtonPosition(autoAttackBtn, UDim2.new(0.5, -90, 0, 100))
        animateButtonPosition(playerInput, UDim2.new(0.5, -90, 0, 145))
        animateButtonPosition(helpModeBtn, UDim2.new(0.5, -90, 0, 190))
    end
end)

autoAbilityOption1.MouseButton1Click:Connect(function()
    currentAbilityMode = "æ™®é€š"
    autoAbilityDropdownBtn.Text = "æ™®é€š â–¼"
    autoAbilityDropdownMenu.Visible = false
    -- é¸å–®é—œé–‰æ™‚ç§»å›æŒ‰éˆ•
    animateButtonPosition(autoAbilityBtn, UDim2.new(0.5, -90, 0, 55))
    animateButtonPosition(autoAttackBtn, UDim2.new(0.5, -90, 0, 100))
    animateButtonPosition(playerInput, UDim2.new(0.5, -90, 0, 145))
    animateButtonPosition(helpModeBtn, UDim2.new(0.5, -90, 0, 190))
end)

autoAbilityOption2.MouseButton1Click:Connect(function()
    currentAbilityMode = "è‡ªè¨‚ä½ç½®"
    autoAbilityDropdownBtn.Text = "è‡ªè¨‚ä½ç½® â–¼"
    autoAbilityDropdownMenu.Visible = false
    -- é¸å–®é—œé–‰æ™‚ç§»å›æŒ‰éˆ•
    animateButtonPosition(autoAbilityBtn, UDim2.new(0.5, -90, 0, 55))
    animateButtonPosition(autoAttackBtn, UDim2.new(0.5, -90, 0, 100))
    animateButtonPosition(playerInput, UDim2.new(0.5, -90, 0, 145))
    animateButtonPosition(helpModeBtn, UDim2.new(0.5, -90, 0, 190))
end)

-- è‡ªå‹•ä½¿ç”¨èƒ½åŠ›åŠŸèƒ½
autoAbilityBtn.MouseButton1Click:Connect(function()
    isAutoAbilityEnabled = not isAutoAbilityEnabled
    autoAbilityBtn.Text = isAutoAbilityEnabled and "è‡ªå‹•ä½¿ç”¨èƒ½åŠ›: é–‹" or "è‡ªå‹•ä½¿ç”¨èƒ½åŠ›: é—œ"
    
    if isAutoAbilityEnabled then
        -- å¦‚æœæ˜¯è‡ªè¨‚ä½ç½®æ¨¡å¼ï¼Œè¨˜éŒ„ç•¶å‰ä½ç½®
        if currentAbilityMode == "è‡ªè¨‚ä½ç½®" then
            local character = LocalPlayer.Character
            if character and character:FindFirstChild("HumanoidRootPart") then
                customStartPosition = character.HumanoidRootPart.Position
                customStartCFrame = character.HumanoidRootPart.CFrame
            end
        end
        
        autoAbilityLoop = task.spawn(function()
            while isAutoAbilityEnabled do
                -- ä½¿ç”¨å±éšœèƒ½åŠ›
                local args = {
                    [1] = 1
                }
                game:GetService("ReplicatedStorage").Barrier:FireServer(unpack(args))
                
                if currentAbilityMode == "æ™®é€š" then
                    -- æ™®é€šæ¨¡å¼ï¼šç­‰25ç§’å¾Œå†åŸ·è¡Œä¸€æ¬¡
                    task.wait(25)
                    if isAutoAbilityEnabled then
                        local args2 = {
                            [1] = 1
                        }
                        game:GetService("ReplicatedStorage").Barrier:FireServer(unpack(args2))
                    end
                elseif currentAbilityMode == "è‡ªè¨‚ä½ç½®" then
                    -- è‡ªè¨‚ä½ç½®æ¨¡å¼ï¼šç­‰25ç§’å¾Œè¨˜éŒ„çµæŸä½ç½®ï¼Œç§»å‹•åˆ°é–‹å§‹ä½ç½®å†åŸ·è¡Œï¼Œç„¶å¾Œå›åˆ°çµæŸä½ç½®
                    task.wait(25)
                    if isAutoAbilityEnabled then
                        local character = LocalPlayer.Character
                        if character and character:FindFirstChild("HumanoidRootPart") then
                            -- è¨˜éŒ„25ç§’å¾Œçš„ä½ç½®å’Œæ–¹å‘
                            customEndPosition = character.HumanoidRootPart.Position
                            customEndCFrame = character.HumanoidRootPart.CFrame
                            
                            -- ç§»å‹•åˆ°é–‹å§‹ä½ç½®
                            if customStartCFrame then
                                character.HumanoidRootPart.CFrame = customStartCFrame
                                
                                -- å†æ¬¡ä½¿ç”¨å±éšœèƒ½åŠ›
                                local args3 = {
                                    [1] = 1
                                }
                                game:GetService("ReplicatedStorage").Barrier:FireServer(unpack(args3))
                                
                                -- ç­‰0.1ç§’å¾Œå›åˆ°åŸæœ¬ä½ç½®
                                task.wait(0.1)
                                if customEndCFrame then
                                    character.HumanoidRootPart.CFrame = customEndCFrame
                                end
                            end
                        end
                    end
                end
                
                task.wait(1)
            end
        end)
    elseif autoAbilityLoop then
        task.cancel(autoAbilityLoop)
        autoAbilityLoop = nil
    end
end)

-- è‡ªå‹•æ”»æ“ŠåŠŸèƒ½
autoAttackBtn.MouseButton1Click:Connect(function()
    isAutoAttackEnabled = not isAutoAttackEnabled
    autoAttackBtn.Text = isAutoAttackEnabled and "è‡ªå‹•æ”»æ“Š: é–‹" or "è‡ªå‹•æ”»æ“Š: é—œ"
    
    if isAutoAttackEnabled then
        autoAttackLoop = task.spawn(function()
            while isAutoAttackEnabled do
                local nearbyPlayer = findPlayerWithin25Units()
                if nearbyPlayer and nearbyPlayer.Character and nearbyPlayer.Character:FindFirstChild("Right Arm") then
                    local args = {
                        [1] = nearbyPlayer.Character:FindFirstChild("Right Arm")
                    }
                    game:GetService("ReplicatedStorage").DefenseHit:FireServer(unpack(args))
                end
                task.wait(1)
            end
        end)
    elseif autoAttackLoop then
        task.cancel(autoAttackLoop)
        autoAttackLoop = nil
    end
end)

-- ä¿®æ”¹æ¨™é¡Œ
Title.Text = "ğŸ”° å±éšœ ğŸ”°"

-- ä¿®æ”¹å…¨åŸŸè®Šæ•¸
local currentHelpMode = "è¢«æ‰“å¾Œé‡ç½®"


-- å‰µå»ºå¹«åŠ©æ¨¡å¼ä¸‹æ‹‰é¸å–®æŒ‰éˆ•
local helpModeDropdownBtn = Instance.new("TextButton", MainScroll)
helpModeDropdownBtn.Size = UDim2.new(0, 180, 0, 35)
helpModeDropdownBtn.Position = UDim2.new(0.5, -90, 0, 235)
helpModeDropdownBtn.Text = "è¢«æ‰“å¾Œé‡ç½® â–¼"
helpModeDropdownBtn.BackgroundColor3 = Color3.fromRGB(80, 140, 220)
helpModeDropdownBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
helpModeDropdownBtn.TextSize = 16
helpModeDropdownBtn.Font = Enum.Font.GothamBold
helpModeDropdownBtn.BorderSizePixel = 0

Instance.new("UICorner", helpModeDropdownBtn).CornerRadius = UDim.new(0, 8)

local helpModeDropdownStroke = Instance.new("UIStroke", helpModeDropdownBtn)
helpModeDropdownStroke.Color = Color3.fromRGB(120, 170, 255)
helpModeDropdownStroke.Thickness = 1
helpModeDropdownStroke.Transparency = 0.6

-- å‰µå»ºå¹«åŠ©æ¨¡å¼ä¸‹æ‹‰èœå–®
local helpModeDropdownMenu = Instance.new("Frame", MainScroll)
helpModeDropdownMenu.Size = UDim2.new(0, 180, 0, 70)
helpModeDropdownMenu.Position = UDim2.new(0.5, -90, 0, 270)
helpModeDropdownMenu.BackgroundColor3 = Color3.fromRGB(45, 45, 65)
helpModeDropdownMenu.BorderSizePixel = 0
helpModeDropdownMenu.Visible = false

Instance.new("UICorner", helpModeDropdownMenu).CornerRadius = UDim.new(0, 8)

local helpModeMenuStroke = Instance.new("UIStroke", helpModeDropdownMenu)
helpModeMenuStroke.Color = Color3.fromRGB(120, 170, 255)
helpModeMenuStroke.Thickness = 1
helpModeMenuStroke.Transparency = 0.6

-- å¹«åŠ©æ¨¡å¼ä¸‹æ‹‰é¸é …1
local helpModeOption1 = Instance.new("TextButton", helpModeDropdownMenu)
helpModeOption1.Size = UDim2.new(1, 0, 0, 35)
helpModeOption1.Position = UDim2.new(0, 0, 0, 0)
helpModeOption1.Text = "è¢«æ‰“å¾Œé‡ç½®"
helpModeOption1.BackgroundColor3 = Color3.fromRGB(60, 60, 85)
helpModeOption1.TextColor3 = Color3.fromRGB(255, 255, 255)
helpModeOption1.TextSize = 14
helpModeOption1.Font = Enum.Font.Gotham
helpModeOption1.BorderSizePixel = 0

-- å¹«åŠ©æ¨¡å¼ä¸‹æ‹‰é¸é …2
local helpModeOption2 = Instance.new("TextButton", helpModeDropdownMenu)
helpModeOption2.Size = UDim2.new(1, 0, 0, 35)
helpModeOption2.Position = UDim2.new(0, 0, 0, 35)
helpModeOption2.Text = "è¢«æ‰“å¾Œä¸é‡ç½®"
helpModeOption2.BackgroundColor3 = Color3.fromRGB(60, 60, 85)
helpModeOption2.TextColor3 = Color3.fromRGB(255, 255, 255)
helpModeOption2.TextSize = 14
helpModeOption2.Font = Enum.Font.Gotham
helpModeOption2.BorderSizePixel = 0

-- èª¿æ•´å¹«åŠ©æ¨¡å¼æŒ‰éˆ•ä½ç½®
helpModeBtn.Position = UDim2.new(0.5, -90, 0, 280)

-- å¹«åŠ©æ¨¡å¼ä¸‹æ‹‰é¸å–®åŠŸèƒ½
helpModeDropdownBtn.MouseButton1Click:Connect(function()
    -- å…³é—­è‡ªåŠ¨ä½¿ç”¨èƒ½åŠ›ä¸‹æ‹‰é€‰å•
    if autoAbilityDropdownMenu.Visible then
        autoAbilityDropdownMenu.Visible = false
        -- å°†æŒ‰é’®ç§»å›åŸä½
        animateButtonPosition(autoAbilityBtn, UDim2.new(0.5, -90, 0, 55))
        animateButtonPosition(autoAttackBtn, UDim2.new(0.5, -90, 0, 100))
        animateButtonPosition(playerInput, UDim2.new(0.5, -90, 0, 145))
        animateButtonPosition(helpModeBtn, UDim2.new(0.5, -90, 0, 190))
    end
    
    helpModeDropdownMenu.Visible = not helpModeDropdownMenu.Visible
    
    if helpModeDropdownMenu.Visible then
        -- é¸å–®å±•é–‹æ™‚ï¼Œå°‡å¹«åŠ©æ¨¡å¼æŒ‰éˆ•å‘ä¸‹ç§»å‹•
        animateButtonPosition(helpModeBtn, UDim2.new(0.5, -90, 0, 350))
    else
        -- é¸å–®é—œé–‰æ™‚ï¼Œå°‡å¹«åŠ©æ¨¡å¼æŒ‰éˆ•ç§»å›åŸä½
        animateButtonPosition(helpModeBtn, UDim2.new(0.5, -90, 0, 280))
    end
end)

helpModeOption2.MouseButton1Click:Connect(function()
    currentHelpMode = "è¢«æ‰“å¾Œä¸é‡ç½®"
    helpModeDropdownBtn.Text = "è¢«æ‰“å¾Œä¸é‡ç½® â–¼"
    helpModeDropdownMenu.Visible = false
    animateButtonPosition(helpModeBtn, UDim2.new(0.5, -90, 0, 280))
end)

-- å¹«åŠ©æ¨¡å¼åŠŸèƒ½
helpModeBtn.MouseButton1Click:Connect(function()
    isHelpModeEnabled = not isHelpModeEnabled
    helpModeBtn.Text = isHelpModeEnabled and "å¹«åŠ©æ¨¡å¼: é–‹" or "å¹«åŠ©æ¨¡å¼: é—œ"
    
    if isHelpModeEnabled then
        local targetName = playerInput.Text
        if targetName == "" then
            helpModeBtn.Text = "å¹«åŠ©æ¨¡å¼: é—œ"
            isHelpModeEnabled = false
            return
        end
        
        helpModeLoop = task.spawn(function()
            while isHelpModeEnabled do
                local character = LocalPlayer.Character
                if not character then
                    character = LocalPlayer.CharacterAdded:Wait()
                end
                
                local humanoidRootPart = character:WaitForChild("HumanoidRootPart", 10)
                local humanoid = character:WaitForChild("Humanoid", 10)
                
                if not humanoidRootPart or not humanoid then
                    task.wait(0.5)
                    continue
                end
                
                if humanoid.Health <= 0 then
                    task.wait(0.3)
                    continue
                end
                
                if currentHelpMode == "è¢«æ‰“å¾Œé‡ç½®" then
                    -- è¢«æ‰“å¾Œé‡ç½®æ¨¡å¼ - ä½¿ç”¨ç¯„æœ¬é‚è¼¯
                    pcall(function()
                        -- å‚³é€åˆ° Lobby.Teleport1
                        local teleport1 = Workspace.Lobby:FindFirstChild("Teleport1")
                        if teleport1 and isHelpModeEnabled then
                            humanoidRootPart.CFrame = teleport1.CFrame
                            task.wait(0.3)
                        end
                        
                        -- æŒçºŒè·Ÿéš¨ç›®æ¨™ç©å®¶
                        local targetPlayer = Players:FindFirstChild(targetName)
                        if targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") and isHelpModeEnabled then
                            local playerWorkspaceFolder = Workspace:FindFirstChild(LocalPlayer.Name)
                            local lastUpdateTime = tick()
                            
                            -- æŒçºŒç§»å‹•ç›´åˆ°æª¢æ¸¬åˆ°LastSlappedBy
                            while isHelpModeEnabled and character.Parent and humanoid.Health > 0 and playerWorkspaceFolder do
                                
                                -- æª¢æŸ¥æ˜¯å¦è¢«ç›®æ¨™ç©å®¶æ‰“ä¸­
                                local lastSlappedBy = playerWorkspaceFolder:FindFirstChild("LastSlappedBy")
                                if lastSlappedBy and lastSlappedBy.Value == targetName then
                                    task.wait(0.5) -- ç­‰å¾…0.5ç§’
                                    break -- è·³å‡ºå¾ªç’°é€²è¡Œé‡ç½®
                                end
                                
                                local currentTime = tick()
                                if currentTime - lastUpdateTime < 0.2 then
                                    task.wait(0.1)
                                    continue
                                end
                                lastUpdateTime = currentTime
                                
                                if not (targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart")) then
                                    break
                                end
                                
                                pcall(function()
                                    local targetRoot = targetPlayer.Character.HumanoidRootPart
                                    local targetPos = targetRoot.Position
                                    local targetLookDirection = targetRoot.CFrame.LookVector
                                    
                                    local newPos = targetPos + (targetLookDirection * 5) + Vector3.new(0, 2, 0)
                                    
                                    if (humanoidRootPart.Position - newPos).Magnitude > 1 then
                                        humanoidRootPart.CFrame = CFrame.new(newPos, newPos + targetLookDirection)
                                    end
                                end)
                                
                                task.wait(0.1)
                            end
                            
                            -- æª¢æŸ¥LastSlappedByä¸¦é‡ç½®
                            if isHelpModeEnabled and playerWorkspaceFolder then
                                local lastSlappedBy = playerWorkspaceFolder:FindFirstChild("LastSlappedBy")
                                if lastSlappedBy and lastSlappedBy.Value == targetName then
                                    
                                    -- å®‰å…¨å‚³é€åˆ°æŒ‡å®šåæ¨™
                                    pcall(function()
                                        if humanoidRootPart and humanoidRootPart.Parent then
                                            humanoidRootPart.CFrame = CFrame.new(263, 13, 197)
                                        end
                                    end)
                                    
                                    task.wait(0.2)
                                    
                                    -- å®‰å…¨é‡ç½®
                                    pcall(function()
                                        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
                                            LocalPlayer.Character.Humanoid:TakeDamage(LocalPlayer.Character.Humanoid.MaxHealth)
                                        end
                                    end)
                                    
                                    -- ç­‰å¾…é‡ç½®å®Œæˆå’Œæ–°è§’è‰²è¼‰å…¥
                                    local resetStartTime = tick()
                                    repeat
                                        task.wait(0.2)
                                        if tick() - resetStartTime > 3 then
                                            break
                                        end
                                    until not LocalPlayer.Character or LocalPlayer.Character.Humanoid.Health <= 0
                                    
                                    -- ç­‰å¾…æ–°è§’è‰²
                                    local newCharacter = nil
                                    local waitStartTime = tick()
                                    repeat
                                        task.wait(0.2)
                                        newCharacter = LocalPlayer.Character
                                        if tick() - waitStartTime > 3 then
                                            break
                                        end
                                    until newCharacter and newCharacter:FindFirstChild("HumanoidRootPart") and 
                                          newCharacter:FindFirstChild("Humanoid") and newCharacter.Humanoid.Health > 0
                                    
                                    task.wait(0.3)
                                end
                            end
                        end
                    end)
                    
                elseif currentHelpMode == "è¢«æ‰“å¾Œä¸é‡ç½®" then
                    -- è¢«æ‰“å¾Œä¸é‡ç½®æ¨¡å¼ - æŒçºŒç§»å‹•åˆ°ç•¶å‰ä½ç½®ç›´åˆ°è§£é™¤
                    pcall(function()
                        local targetPlayer = Players:FindFirstChild(targetName)
                        if targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") and isHelpModeEnabled then
                            
                            while isHelpModeEnabled and character.Parent and humanoid.Health > 0 do
                                
                                if not (targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart")) then
                                    break
                                end
                                
                                pcall(function()
                                    local targetRoot = targetPlayer.Character.HumanoidRootPart
                                    local targetPos = targetRoot.Position
                                    local targetLookDirection = targetRoot.CFrame.LookVector
                                    
                                    local newPos = targetPos + (targetLookDirection * 5) + Vector3.new(0, 2, 0)
                                    
                                    humanoidRootPart.CFrame = CFrame.new(newPos, newPos + targetLookDirection)
                                end)
                                
                                task.wait(0.1)
                            end
                        end
                    end)
                end
                
                if isHelpModeEnabled then
                    task.wait(1)
                end
            end
        end)
    elseif helpModeLoop then
        task.cancel(helpModeLoop)
        helpModeLoop = nil
    end
end)
